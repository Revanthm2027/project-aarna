<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>Project AARNA · Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/styles.css" />
  
  <!-- Vercel Web Analytics -->
  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>
<body class="admin-body">
  <header class="navbar">
    <div class="nav-inner">
      <a href="/" class="brand">
        <span class="logo-slot"></span>
        <span class="brand-text">
          Project <strong>AARNA</strong>
          <span class="brand-sub">Admin Console</span>
        </span>
      </a>

      <div class="nav-actions">
        <a class="btn btn-secondary" href="/">Back to site</a>
        <button class="theme-toggle" id="theme-toggle" type="button" aria-label="Toggle theme">
          <span class="theme-icon">☾</span>
        </button>
      </div>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="section-header center">
        <h2>Admin</h2>
        <p>Sign in to manage messages, experiments, and visitor stats.</p>
      </div>

      <div id="auth-card" class="contact-form-card hover-float" style="max-width: 560px; margin: 0 auto;">
        <h3>Sign in</h3>
        <form id="admin-login-form" class="contact-form" method="post" action="javascript:void(0)">
          <label>
            Email
            <input type="email" name="email" required />
          </label>
          <label>
            Password
            <input type="password" name="password" required />
          </label>
          <button type="submit" class="btn btn-primary">Login</button>
        </form>
        <p id="login-status" class="form-info"></p>
      </div>

      <div id="dashboard" style="display:none; max-width: 1200px; margin: 2rem auto 0;">
        <div class="admin-tabs">
          <button class="admin-tab active" data-tab="stats">Stats</button>
          <button class="admin-tab" data-tab="messages">Messages</button>
          <button class="admin-tab" data-tab="experiments">Experiments</button>
          <button class="admin-tab" data-tab="newsletter">Newsletter</button>

          <div class="admin-actions">
            <button id="refresh-btn" class="btn btn-secondary" type="button">Refresh</button>
            <button id="logout-btn" class="btn btn-secondary" type="button">Logout</button>
          </div>
        </div>

        <!-- STATS -->
        <section id="panel-stats" class="admin-panel" style="display:block;">
          <div class="section-header center" style="margin-top: 0.4rem;">
            <h2>Stats</h2>
            <p>Quick overview for daily operations.</p>
          </div>

          <div class="methodology-grid">
            <div class="method-card hover-float"><h3>Inbox</h3><p id="stat-new">—</p></div>
            <div class="method-card hover-float"><h3>Contacted</h3><p id="stat-contacted">—</p></div>
            <div class="method-card hover-float"><h3>Closed</h3><p id="stat-closed">—</p></div>
            <div class="method-card hover-float"><h3>Newsletter</h3><p id="stat-subs">—</p></div>
          </div>

          <div class="methodology-grid" style="margin-top: 16px;">
            <div class="method-card hover-float"><h3>Visitors today</h3><p id="stat-v-today">—</p></div>
            <div class="method-card hover-float"><h3>Visitors (7d)</h3><p id="stat-v-7d">—</p></div>
            <div class="method-card hover-float"><h3>Visitors (30d)</h3><p id="stat-v-30d">—</p></div>
            <div class="method-card hover-float"><h3>Page views (30d)</h3><p id="stat-pv-30d">—</p></div>
          </div>

          <p class="form-info" style="margin-top:10px; text-align:center;">
            Visitor stats are estimated using unique IP hashes per day (privacy-safe).
          </p>
        </section>

        <!-- MESSAGES -->
        <section id="panel-messages" class="admin-panel" style="display:none;">
          <div class="section-header center" style="margin-top: 0.4rem;">
            <h2>Messages</h2>
            <p>Triage contact requests and track follow-ups.</p>
          </div>

          <div class="section-header center" style="margin: 1.6rem 0 1rem;">
            <h2 style="font-size:1.6rem;">Inbox (New)</h2>
          </div>
          <div class="contact-form-card hover-float">
            <div style="overflow:auto;">
              <table class="admin-table">
                <thead><tr><th>Time</th><th>Name</th><th>Email</th><th>Message</th><th>Status</th></tr></thead>
                <tbody id="contacts-new-tbody"></tbody>
              </table>
            </div>
          </div>

          <div class="section-header center" style="margin: 2.2rem 0 1rem;">
            <h2 style="font-size:1.6rem;">Contacted</h2>
          </div>
          <div class="contact-form-card hover-float">
            <div style="overflow:auto;">
              <table class="admin-table">
                <thead><tr><th>Time</th><th>Name</th><th>Email</th><th>Message</th><th>Status</th></tr></thead>
                <tbody id="contacts-contacted-tbody"></tbody>
              </table>
            </div>
          </div>

          <div class="section-header center" style="margin: 2.2rem 0 1rem;">
            <h2 style="font-size:1.6rem;">Closed</h2>
          </div>
          <div class="contact-form-card hover-float">
            <div style="overflow:auto;">
              <table class="admin-table">
                <thead><tr><th>Time</th><th>Name</th><th>Email</th><th>Message</th><th>Status</th></tr></thead>
                <tbody id="contacts-closed-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- EXPERIMENTS -->
        <section id="panel-experiments" class="admin-panel" style="display:none;">
          <div class="section-header center" style="margin-top: 0.4rem;">
            <h2>Experiments</h2>
            <p>Add/edit/publish what appears in the live “Experiments” section.</p>
          </div>

          <div class="admin-split">
            <div class="contact-form-card hover-float">
              <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
                <h3 style="margin:0; width:100%; text-align:center;">Experiments list</h3>
                <div style="display:flex; gap:10px; width:100%; justify-content:center;">
                  <button id="new-exp-btn" class="btn btn-secondary" type="button">+ New</button>
                </div>
              </div>

              <div style="overflow:auto; margin-top: 10px;">
                <table class="admin-table">
                  <thead>
                    <tr>
                      <th>Title</th><th>Status</th><th>Published</th><th>Order</th><th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="experiments-tbody"></tbody>
                </table>
              </div>

              <p class="form-info" style="margin-top:10px; text-align:center;">
                Tip: “Order” controls display priority. Smaller = higher.
              </p>
            </div>

            <!-- HIDDEN by default; shows on +New or Edit -->
            <div id="experiment-form-card" class="contact-form-card hover-float" style="display:none;">
              <h3 id="exp-form-title" style="text-align:center;">New experiment</h3>

              <form id="experiment-form" class="contact-form" method="post" action="javascript:void(0)">
                <input type="hidden" id="exp-id" />

                <label>
                  Title
                  <input type="text" id="exp-title" required />
                </label>

                <label>
                  Status
                  <select id="exp-status">
                    <option>Upcoming</option>
                    <option>Planned</option>
                    <option>Design stage</option>
                  </select>
                </label>

                <label>
                  Location (optional)
                  <input type="text" id="exp-location" placeholder="e.g., XYZ Mangrove Reserve" />
                </label>

                <label>
                  Summary
                  <textarea id="exp-summary" rows="4" required></textarea>
                </label>

                <label>
                  Sort order (smaller = higher)
                  <input type="number" id="exp-sort" value="100" />
                </label>

                <label style="display:flex; gap:10px; align-items:center; font-size:0.95rem; color: var(--text-muted); text-transform:none; letter-spacing:0;">
                  <input type="checkbox" id="exp-published" checked />
                  Published (visible on live site)
                </label>

                <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
                  <button type="submit" class="btn btn-primary" id="exp-save-btn">Save</button>
                  <button type="button" class="btn btn-secondary" id="exp-cancel-btn">Close</button>
                  <button type="button" class="btn btn-secondary" id="exp-delete-btn" style="border-color: rgba(239,68,68,0.4); display:none;">Delete</button>
                </div>

                <p class="form-info" id="exp-status-text" style="text-align:center;"></p>
              </form>
            </div>
          </div>
        </section>

        <!-- NEWSLETTER -->
        <section id="panel-newsletter" class="admin-panel" style="display:none;">
          <div class="section-header center" style="margin-top: 0.4rem;">
            <h2>Newsletter</h2>
            <p>Emails that opted in from the contact form.</p>
          </div>

          <div class="contact-form-card hover-float">
            <div style="overflow:auto;">
              <table class="admin-table">
                <thead><tr><th>Time</th><th>Email</th></tr></thead>
                <tbody id="subs-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="/js/supabaseClient.js"></script>
  <script src="/admin/admin.js"></script>
</body>
</html>
